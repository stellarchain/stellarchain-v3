{% extends 'base.html.twig' %}

{% block title %}Markets{% endblock %}

{% block body %}
<div class="vh-100 overflow-y-scroll overflow-x-hidden hide-scrollbar" {{stimulus_controller('horizon', {assetCode:
    asset.assetCode, assetIssuer: asset.assetIssuer})}}>
    <div class="card mt-2">
        <div class="asset-header row">
            <div class="col-md-2 d-flex justify-content-center">
                <div class="icon-container mb-2">
                    {% if toml is defined %}
                    <img src="{{toml.image}}" height="75px" class="rounded-circle" />
                    {% else%}
                    <img src="https://stellarchain.io/img/xlm.316d17cc.png" height="75px" class="rounded-circle" />
                    {% endif %}
                </div>
            </div>
            <div class="col-md-10">
                <div class="info-section mt-2">
                    {% if toml is defined and toml.name is defined %}
                        <h2 class="mb-2">{{toml.name}}<span> {{asset.assetCode}} </span></h2>
                    {% else %}
                        <h2 class="mb-2"><span> {{asset.assetCode}} </span></h2>
                    {% endif %}

                    {% if toml is defined %}
                    <p>
                        {% if toml.url is defined %}
                            <span class="small"> <a href="{{ toml.url}}">{{toml.url}}</a> </span>
                        {% endif %}
                    </p>
                    <p>
                        {% if toml.desc is defined %}
                        {{ toml.desc }}
                        {% endif %}
                    </p>

                    {% endif %}
                    <p class="small">Issuer:
                        <a href="https://stellarchain.io/accounts/{{asset.assetIssuer}}">{{asset.assetIssuer}}</a>
                    </p>
                    <p class="small">Contract: <span id="contractId"></span></p>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card text-center d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-currency-dollar text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title m-0">Market Price</h5>
                    <p class="card-text">
                        <span class="text-success">${{priceMarket | number_format(5)}}</span>
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi  bi-graph-up-arrow text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title m-0">Market Cap</h5>
                    <p class="card-text">
                        <span class="text-success">${{marketCap | number_format}}</span>
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-percent text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title m-0">Change 24h</h5>
                    <p class="card-text">
                        <span class="text-success">{{latestMetric.priceChange24h}}%</span>
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-database text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title m-0">Volume 24h</h5>
                    <p class="card-text">
                        <span class="text-warning">{{latestMetric.volume24h | number_format}}
                            {{asset.assetCode}}</span>
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-hdd-rack text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title m-0">Trades</h5>
                    <p class="card-text">
                        <span class="text-warning">{{latestMetric.totalTrades}}</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body d-flex flex-row justify-content-between rounded-top">
                    <div class="chart-tick">
                        <h5 class="card-title">{{asset.assetCode}}/XLM</h5>
                    </div>
                    <div class="d-flex timeframes">
                        <span class="p-1 bg-black rounded small hover m-1">1m</span>
                        <span class="p-1 bg-black rounded small hover m-1">5m</span>
                        <span class="p-1 bg-black rounded small hover m-1">15m</span>
                        <span class="p-1 bg-black rounded small hover m-1">1h</span>
                        <span class="p-1 rounded small hover m-1 bg-primary">1d</span>
                        <span class="p-1 bg-black rounded small hover m-1">1w</span>
                    </div>
                </div>
            </div>

            <div class="card text-center">
                <div class="card-body rounded-bottom">
                    <div id="trades-chart" class="rounded" style="height:390px" {{ stimulus_target('horizon', 'chart' ) }}></div>
                    <div class="spinner-border text-primary z-1 ml-auto absolute position-absolute top-50 start-50 d-none"
                        id="loading-chart" role="status" aria-hidden="true"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-md-4">
                <div class="card d-flex flex-row p-2 gap-2 mb-2">
                    <span class="p-1">
                        <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-wallet text-primary fs-5"></i></div>
                    </span>
                    <div class="rounded">
                        <h5 class="card-title">Total amount</h5>
                        <p class="card-text text-muted" id="total_amount"></p
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-cash text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title">Claimable Balances</h5>
                    <p class="card-text text-muted" id="claimable_balances"></p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-activity text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title">Liquidity Pools</h5>
                    <p class="card-text text-muted"><span id="liquidity_pools"></span></p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-journal-text text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title">Contracts</h5>
                    <p class="card-text text-muted"><span id="num_contracts"></span></p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-bar-chart-line text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title">Contracts amount</h5>
                    <p class="card-text text-muted"><span id="contracts_amount"></span></p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card d-flex flex-row p-2 gap-2 mb-2">
                <span class="p-1">
                    <div class="icon d-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded" style="height: 44px; width: 44px;"><i class="bi bi-hdd-rack text-primary fs-5"></i></div>
                </span>
                <div class="rounded">
                    <h5 class="card-title">Authorized accounts</h5>
                    <p class="card-text text-muted"><span id="authorized_accounts"></span></p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4 d-flex">
        <div class="col-md-7 mb-2">
            <div class="flex-fill">
                <div class="chart card p-3">
                    <span class="text-center">Price {{asset.assetCode}}/XLM</span>
                    {{render_chart(chart)}}
                </div>

                <div class="card text-center mt-2">
                    <div class="card-title mt-3">Order Book</div>
                    <div class="card-body payments align-items-start d-flex rounded">
                        <table id="bidTable"
                            class="table table-responsive table-striped table-hover table-trades table-borderless" {{
                            stimulus_target('horizon', 'bid' ) }}>
                            <thead>
                                <tr>
                                    <th scope="col" class="small text-secondary text-start"> Amount XLM</th>
                                    <th scope="col" class="small text-secondary text-end"> Price XLM </th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <table id="askTable"
                            class="table table-responsive table-striped table-hover table-trades table-borderless" {{
                            stimulus_target('horizon', 'ask' ) }}>
                            <thead>
                                <tr>
                                    <th scope="col" class="small text-secondary text-start"> Price XLM </th>
                                    <th scope="col" class="small text-secondary text-end"> Amount {{asset.assetCode}} </th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-5 d-flex">
            <div class="card flex-fill text-center h-100">
                <div class="card-title mt-3">Live Trades</div>
                <div class="card-body trades-card  overflow-auto">
                    <table id="trades"
                        class="table table-responsive table-striped table-hover table-trades table-borderless tableFixHead" {{
                        stimulus_target('horizon', 'trades' ) }}>
                        <thead>
                            <tr>
                                <th scope="col" class="small text-secondary bg-black"> Amount {{asset.assetCode}} </th>
                                <th scope="col" class="small text-secondary bg-black"> Amount XLM </th>
                                <th scope="col" class="small text-secondary bg-black"> Price XLM </th>
                                <th scope="col" class="small text-secondary bg-black"> Time </th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
        </div>

    </div>

    <div class="py-4">
        <span>&nbsp;</span>
    </div>

    <div class="mt-0 d-block d-sm-none">
        <span>&nbsp;</span>
    </div>
</div>
{% endblock %}
